# ImgBed

使用node.js实现的简单私有图床

## 安装

```shell
npm i -g imagebed
```

## 启动

```shell
imgbed --port=1234 --secret=123456 --base=/path/to/dir
```

### 参数说明

所有参数都有默认值，为了稳定尽可能手动设置。

#### port

服务器端口，默认`23888`

#### secret

加密secret，上传和删除文件需要通过secret计算签名。

默认会生成随机数，可通过控制台信息获取。

为保证安全性，建议使用环境变量启动。

```shell
imgbed --secret=$SECRET
```

#### base

文件存储的根目录，建议使用绝对路径。

默认当前路径下的`uploads`文件夹。

#### limit

文件大小限制，默认`5mb`。

#### expire

鉴权超时时间，默认`10`秒。

#### hostname

域名，会根据这个参数生成实际文件地址，默认`http://localhost:23888/`。

## 使用方法

### 签名

#### 签名步骤

1. 生成时间戳，精确到秒
2. 使用secret作为密钥，对时间戳进行`Hmac-sha256`加密，生成16进制hash

伪代码：

```
date = parseInt(Date.now() / 1000)
sign = HmacSha256(date, secret).digest('hex')
```

#### 使用签名

将时间戳和签名放到请求头。

```
Authorization: sign
Date: date
```

### 上传文件

请求方法：`PUT`

请求地址：`/`

请求内容：图片源文件内容

是否需要签名：**是**

返回结果示例：

```json
{
    "url":"http://localhost:23888/123456123456"
}
```

### 删除文件

请求方法：`DELETE`

请求地址：`/文件名`

示例：`/123456123456`

请求内容：空

是否需要签名：**是**

返回结果示例：

```json
{
    "message":"ok"
}
```

### 下载文件

请求方法：`GET`

请求地址：`/文件名`

示例：`/123456123456`

请求内容：空

是否需要签名：否

### 图片缩略图

请求方法：`GET`

请求地址：`/文件名?percent`

参数：percent，一个数字，代表将图片缩放的比例，如40，即将原图缩放到40%的宽高

示例：`/123456123456?40`

请求内容：空

是否需要签名：否